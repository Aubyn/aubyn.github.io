import{l as i,c as a,b as n,aj as l}from"./chunks/framework.CZoYd-ur.js";const c=JSON.parse('{"title":"Node.js ç¯å¢ƒ","description":"","frontmatter":{},"headers":[],"relativePath":"blog/docker/node.md","filePath":"blog/docker/node.md"}'),h={name:"blog/docker/node.md"};function p(e,s,t,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="node-js-ç¯å¢ƒ" tabindex="-1">Node.js ç¯å¢ƒ <a class="header-anchor" href="#node-js-ç¯å¢ƒ" aria-label="Permalink to &quot;Node.js ç¯å¢ƒ&quot;">â€‹</a></h1><h2 id="why" tabindex="-1">why <a class="header-anchor" href="#why" aria-label="Permalink to &quot;why&quot;">â€‹</a></h2><ul><li>æµ‹è¯•ï¼šå¿«é€Ÿç”Ÿæˆ Node.js ç¯å¢ƒï¼Œæ‰§è¡Œ JS/TS æµ‹è¯•è„šæœ¬</li><li>è¿è¡Œ/æ„å»ºï¼šæŒ‡å®š Node.js ç‰ˆæœ¬ï¼Œè¿è¡Œ/æ„å»º JS/TS å‰åç«¯æœåŠ¡</li><li>å¼€å‘ï¼šåˆ›å»ºå¯å¤ç”¨ Node.js å®¹å™¨ï¼Œä½œä¸º JS/TS å¼€å‘ç¯å¢ƒ</li></ul><h2 id="how" tabindex="-1">how <a class="header-anchor" href="#how" aria-label="Permalink to &quot;how&quot;">â€‹</a></h2><h3 id="â—‹-æµ‹è¯•" tabindex="-1">â—‹ æµ‹è¯• <a class="header-anchor" href="#â—‹-æµ‹è¯•" aria-label="Permalink to &quot;â—‹ æµ‹è¯•&quot;">â€‹</a></h3><ul><li>æŒ‚è½½è„šæœ¬ç›®å½•</li><li>è¿è¡Œ Node.js é•œåƒï¼Œè¿è¡ŒæŒ‚è½½ç›®å½•ä¸­çš„è„šæœ¬</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    --mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type=bind,source=/home/aubur/app,target=/app</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/library/node:lts-alpine</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/index.js</span></span></code></pre></div><h3 id="â—‹-è¿è¡Œ-æ„å»º" tabindex="-1">â—‹ è¿è¡Œ/æ„å»º <a class="header-anchor" href="#â—‹-è¿è¡Œ-æ„å»º" aria-label="Permalink to &quot;â—‹ è¿è¡Œ/æ„å»º&quot;">â€‹</a></h3><ul><li>æŒ‚è½½ pnpm å…¨å±€å­˜å‚¨ç›®å½•ã€é¡¹ç›®ç›®å½•ï¼ˆå« node_modulesï¼‰</li><li>æ„å»ºé•œåƒï¼šå®‰è£…ä¾èµ–ï¼Œè¿è¡Œ/æ„å»ºé¡¹ç›®</li><li>è¿è¡Œé•œåƒ</li></ul><h3 id="â—‹-å¼€å‘" tabindex="-1">â—‹ å¼€å‘ <a class="header-anchor" href="#â—‹-å¼€å‘" aria-label="Permalink to &quot;â—‹ å¼€å‘&quot;">â€‹</a></h3><ul><li>æŒ‚è½½ pnpm å…¨å±€å­˜å‚¨ç›®å½•ã€é¡¹ç›®ç›®å½•ï¼ˆå« node_modulesï¼‰ã€å¯åŠ¨è„šæœ¬ç›®å½•ï¼Œ<code>/root/.vscode-server</code> ç›®å½•</li><li>æ„å»ºé•œåƒ <ul><li>åŸºäº node + alpine</li><li>æš´éœ² ssh çš„ 22 ç«¯å£</li><li>æ›´æ–° alpine ç³»ç»Ÿè½¯ä»¶åŒ…ï¼Œssh ç›¸å…³ + vscode è¿œç¨‹è¿æ¥ç›¸å…³</li><li>ç”Ÿæˆ ssh å¯†é’¥</li><li>æ›´æ–° ssh é…ç½®</li><li>æ‰§è¡Œå¯åŠ¨è„šæœ¬ï¼šæ·»åŠ æˆæƒçš„ ssh å…¬é’¥ï¼ˆä½¿æœ¬åœ°æ— é¡»å¯†ç è¿æ¥å®¹å™¨ï¼‰ï¼Œè¿è¡Œ sshdï¼Œä¸é€€å‡ºè„šæœ¬</li></ul></li><li>è¿è¡Œå®¹å™¨ï¼Œvscode è¿œç¨‹è¿æ¥å®¹å™¨</li></ul><div class="language-Dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é•œåƒæ¥è‡ªæ¸¡æ¸¡é¸Ÿé•œåƒåŒæ­¥ç«™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/library/node:lts-alpine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æš´éœ² ssh ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 22</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è½¯ä»¶æºæ¥è‡ªé˜¿é‡Œäº‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sed -i </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/apk/repositories \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; apk update \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; apk add gcompat libstdc++ curl bash git openssh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”Ÿæˆ ssh å¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssh-keygen -A</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># vscode ssh è¿æ¥ï¼Œä¾èµ– AllowTcpForwarding</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ğŸš¨æ³¨æ„ï¼š/etc/ssh/sshd_config å’Œ /etc/ssh/ssh_config æ˜¯ 2 ä¸ªä¸åŒçš„æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sed -i </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s/#PermitRootLogin.*/PermitRootLogin yes/g&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/ssh/sshd_config \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; sed -i </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s/#PubkeyAuthentication.*/PubkeyAuthentication yes/g&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/ssh/sshd_config \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; sed -i </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s/#PasswordAuthentication.*/PasswordAuthentication yes/g&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/ssh/sshd_config \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; sed -i </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s/#PermitTunnel.*/PermitTunnel yes/g&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/ssh/sshd_config \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; sed -i </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s/AllowTcpForwarding.*/AllowTcpForwarding yes/g&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /etc/ssh/sshd_config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é…ç½® ssh æœ¬åœ°å…¬é’¥åˆ°å®¹å™¨ä¸­ï¼ˆè¿è¡Œæ—¶é…ç½®ï¼Œæ–¹ä¾¿åŠ¨æ€ä¿®æ”¹ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ğŸš¨æ³¨æ„ï¼š~/.ssh/authorized_keys ä¸­ ~ home ç›®å½•ï¼Œå¯¹åº”å®¹å™¨ä¸­çš„ /root</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è„šæœ¬ä¸­æœ€åä¸€è¡Œå‘½ä»¤å®ç°è„šæœ¬ä¸ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ğŸš¨init.sh è„šæœ¬ä¹Ÿå¯ç›´æ¥ä»ä¸»æœºæŒ‚è½½</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mkdir -p /root/.ssh&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt; /root/init.sh \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cat /work/ssh/authorized_keys &gt; /root/.ssh/authorized_keys&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt;&gt; /root/init.sh \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/usr/sbin/sshd&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt;&gt; /root/init.sh \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &amp;&amp; echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tail -f /dev/null&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt;&gt; /root/init.sh</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨ ssh æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/root/init.sh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºé•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aubur/node-lts-alpine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å‡†å¤‡æŒ‚è½½ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/aubur/work/docker/ssh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/id_ed25519.pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/aubur/work/docker/ssh/authorized_keys</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é™é»˜è¿è¡Œï¼Œå¯åŠ¨ ssh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type=bind,source=/home/aubur/work/docker,target=/work</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4022:22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aubur/node-lts-alpine</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é™é»˜è¿è¡Œåï¼Œå¯é€šè¿‡å®¹å™¨ id ä¸´æ—¶è¿›å…¥äº¤äº’æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $containerId </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/bin/sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># äº¤äº’è¿è¡Œï¼Œå¯åŠ¨ç»ˆç«¯ï¼Œç”¨äºè°ƒè¯•å®¹å™¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --mount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type=bind,source=/home/aubur/work/docker,target=/work</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4022:22</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aubur/node-lts-alpine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/sh</span></span></code></pre></div><h2 id="å‚è€ƒ" tabindex="-1">å‚è€ƒ <a class="header-anchor" href="#å‚è€ƒ" aria-label="Permalink to &quot;å‚è€ƒ&quot;">â€‹</a></h2><ul><li><a href="https://www.cnblogs.com/servlet-context/p/18144665" target="_blank" rel="noreferrer">ã€VSCodeã€‘è¿œç¨‹ç¼–ç ï¼Œsshè¿æ¥å¡åœ¨downloading vscode server - NotReferenced - åšå®¢å›­</a>ï¼Œæ‰‹åŠ¨å®‰è£… vscode serverï¼Œé…ç½® ssh å…¬é’¥</li></ul>`,15)])])}const g=i(h,[["render",p]]);export{c as __pageData,g as default};
